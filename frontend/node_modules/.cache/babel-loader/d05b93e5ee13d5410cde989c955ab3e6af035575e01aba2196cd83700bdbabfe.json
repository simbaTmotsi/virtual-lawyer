{"ast":null,"code":"var _jsxFileName = \"/Users/simbatmotsi/Documents/Projects/virtual-lawyer/frontend/src/components/auth/ProtectedRoute.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef } from 'react';\nimport { Navigate, useLocation, useNavigate } from 'react-router-dom';\nimport { useAuth } from '../../contexts/AuthContext';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ProtectedRoute = ({\n  children,\n  adminOnly = false\n}) => {\n  _s();\n  const {\n    isAuthenticated,\n    user,\n    loading,\n    checkAuthStatus\n  } = useAuth();\n  const location = useLocation();\n  const navigate = useNavigate();\n  const authCheckPerformedRef = useRef(false);\n  useEffect(() => {\n    // Only attempt to verify token if we're not already authenticated and not currently loading\n    // and haven't already performed a check on this render cycle\n    if (!loading && !isAuthenticated && !authCheckPerformedRef.current) {\n      // Add a debounce mechanism using localStorage to prevent multiple simultaneous checks\n      const lastCheck = localStorage.getItem('auth_last_check');\n      const now = Date.now();\n\n      // Only check if more than 5 seconds have passed since last check\n      if (!lastCheck || now - parseInt(lastCheck) > 5000) {\n        localStorage.setItem('auth_last_check', now.toString());\n        authCheckPerformedRef.current = true;\n        const verify = async () => {\n          const isValid = await checkAuthStatus();\n          if (!isValid) {\n            // If not valid and we need authentication, redirect to login\n            navigate('/login', {\n              state: {\n                from: location\n              },\n              replace: true\n            });\n          }\n        };\n        verify();\n      }\n    }\n  }, [isAuthenticated, loading, checkAuthStatus, navigate, location]);\n  if (loading) {\n    // Return loading indicator\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex justify-center items-center h-screen\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 41,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 40,\n      columnNumber: 7\n    }, this);\n  }\n  if (!isAuthenticated) {\n    // If auth check is complete and user is not authenticated, redirect to login\n    return /*#__PURE__*/_jsxDEV(Navigate, {\n      to: \"/login\",\n      state: {\n        from: location\n      },\n      replace: true\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 48,\n      columnNumber: 12\n    }, this);\n  }\n  if (adminOnly && (user === null || user === void 0 ? void 0 : user.role) !== 'admin') {\n    // If admin-only route but user is not admin, redirect to dashboard\n    return /*#__PURE__*/_jsxDEV(Navigate, {\n      to: \"/\",\n      replace: true\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 53,\n      columnNumber: 12\n    }, this);\n  }\n\n  // User is authenticated, render the protected content\n  return children;\n};\n_s(ProtectedRoute, \"4gi9bbXraVYKAKvRRlHsIbVAorE=\", false, function () {\n  return [useAuth, useLocation, useNavigate];\n});\n_c = ProtectedRoute;\nexport default ProtectedRoute;\nvar _c;\n$RefreshReg$(_c, \"ProtectedRoute\");","map":{"version":3,"names":["React","useEffect","useRef","Navigate","useLocation","useNavigate","useAuth","jsxDEV","_jsxDEV","ProtectedRoute","children","adminOnly","_s","isAuthenticated","user","loading","checkAuthStatus","location","navigate","authCheckPerformedRef","current","lastCheck","localStorage","getItem","now","Date","parseInt","setItem","toString","verify","isValid","state","from","replace","className","fileName","_jsxFileName","lineNumber","columnNumber","to","role","_c","$RefreshReg$"],"sources":["/Users/simbatmotsi/Documents/Projects/virtual-lawyer/frontend/src/components/auth/ProtectedRoute.js"],"sourcesContent":["import React, { useEffect, useRef } from 'react';\nimport { Navigate, useLocation, useNavigate } from 'react-router-dom';\nimport { useAuth } from '../../contexts/AuthContext';\n\nconst ProtectedRoute = ({ children, adminOnly = false }) => {\n  const { isAuthenticated, user, loading, checkAuthStatus } = useAuth();\n  const location = useLocation();\n  const navigate = useNavigate();\n  const authCheckPerformedRef = useRef(false);\n\n  useEffect(() => {\n    // Only attempt to verify token if we're not already authenticated and not currently loading\n    // and haven't already performed a check on this render cycle\n    if (!loading && !isAuthenticated && !authCheckPerformedRef.current) {\n      // Add a debounce mechanism using localStorage to prevent multiple simultaneous checks\n      const lastCheck = localStorage.getItem('auth_last_check');\n      const now = Date.now();\n      \n      // Only check if more than 5 seconds have passed since last check\n      if (!lastCheck || (now - parseInt(lastCheck)) > 5000) {\n        localStorage.setItem('auth_last_check', now.toString());\n        authCheckPerformedRef.current = true;\n        \n        const verify = async () => {\n          const isValid = await checkAuthStatus();\n          if (!isValid) {\n            // If not valid and we need authentication, redirect to login\n            navigate('/login', { state: { from: location }, replace: true });\n          }\n        };\n        \n        verify();\n      }\n    }\n  }, [isAuthenticated, loading, checkAuthStatus, navigate, location]);\n\n  if (loading) {\n    // Return loading indicator\n    return (\n      <div className=\"flex justify-center items-center h-screen\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500\"></div>\n      </div>\n    );\n  }\n\n  if (!isAuthenticated) {\n    // If auth check is complete and user is not authenticated, redirect to login\n    return <Navigate to=\"/login\" state={{ from: location }} replace />;\n  }\n\n  if (adminOnly && user?.role !== 'admin') {\n    // If admin-only route but user is not admin, redirect to dashboard\n    return <Navigate to=\"/\" replace />;\n  }\n\n  // User is authenticated, render the protected content\n  return children;\n};\n\nexport default ProtectedRoute;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}